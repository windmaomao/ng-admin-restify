<!doctype html>
<html lang="en">
  <head>
    <title>ngAdmin Restify</title>
    <link rel="stylesheet" href="node_modules/ng-admin/build/ng-admin.min.css">
  </head>
  <body ng-app="myApp">
    <div ui-view></div>

    <script src="node_modules/ng-admin/build/ng-admin.min.js"></script>
    <script src="app.js"></script>

    <script type="text/javascript">

        angular
            .module('myApp', ['ng-admin-restify'])
            .config(function(ngAdminRestifyProvider) {
                var options = {
                    site: 'My Blogs',
                    url: '/v1/',
                    rest: {
                        url: '/v1/',
                        filter: 'flat',
                        page: {
                            start: '_start',
                            end: '_end',
                            limit: '_limit',
                            page: false,
                        },
                        sort: {
                            field: '_sort',
                            order: '_order',
                            plus: false
                        }
                    },
                    entities: {
                        post: {
                            entity: 'post',
                            model: {
                                id: { type: 'integer' },
                                title: { type: 'string', required: true },
                                author: 'string',
                                comments: { type: 'referenced_list' },
                            },
                            id: 'id',
                            fields: {
                                title: {
                                    type: 'string',
                                    detailRoute: 'show'
                                },
                                comments: {
                                    type: 'referenced_list',
                                    targetEntity: 'comment',
                                    targetReferenceField: 'postId',
                                    targetFields: ['id','body'],
                                    sort: {
                                        field: 'id',
                                        dir: 'DESC'
                                    }
                                },
                            },
                            default: {
                                fields: [ 'id', 'title', 'author', 'comments' ],
                            },
                            list: {
                                actions: ['edit']
                            },
                            creation: {},
                            edition: {},
                            show: {
                                title: 'title',
                            },
                            search: {
                                fields: ['id']
                            },
                        },
                        comment: {
                            entity: 'comment',
                            model: {
                                id: { type: 'integer' },
                                postId: { type: 'id', ref: 'post' },
                                body: { type: 'string', required: true },
                            },
                            id: 'id',
                            fields: {
                                postId: {
                                    field: 'postId',
                                    type: 'reference',
                                    targetEntity: 'post',
                                    targetField: 'title',
                                    sort: {
                                        field: 'title',
                                        dir: 'ASC'
                                    },
                                    perPage: 200,
                                    pinned: true
                                },
                            },
                            default: {
                                fields: [ 'id', 'postId', 'body' ],
                            },
                            list: {},
                            creation: {},
                            edition: {},
                            show: {
                                title: 'body'
                            },
                            search: {
                                fields: ['id', 'postId']
                            },
                        }
                    }
                };
                var app = ngAdminRestifyProvider.configure(options);
            })
        ;

    </script>
  </body>
</html>
